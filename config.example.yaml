# CLI Gateway Configuration Template
# Copy to config.yaml and fill in your values

# ──────────── 鉴权 ────────────
auth:
  allowed_users:
    - 123456789  # Replace with your Telegram user ID
  # Optional: restrict bot usage to specific chats/groups
  # allowed_chats:
  #   - -1001234567890  # Telegram group chat ID
  # Optional: per-user rate limit (requests/min). 0 = disabled
  max_requests_per_minute: 30
  # Optional: privileged admin users (for future admin commands)
  admin_users:
    - 123456789
  # Optional: persist allowlist changes across restarts
  state_file: "./data/auth_state.json"

# ──────────── 消息通道 ────────────
channels:
  telegram:
    enabled: true
    token: "${TG_BOT_TOKEN}"  # Set via environment variable
    parse_mode: "HTML"
    max_message_length: 4096

# ──────────── CLI Agents ────────────
agents:
  claude:
    enabled: true
    display_name: "Claude Code"
    command: "claude"
    args_template: ["-p", "{prompt}", "--session-id", "{session_id}", "--output-format", "text"]
    interactive: false
    timeout: 300
    max_concurrent_sessions: 3
    env:
      CLAUDE_CODE_DISABLE_NONINTERACTIVE_CONSENT: "1"
    models:
      sonnet: "claude-sonnet-4-5"
      opus: "claude-opus-4-6"
      haiku: "claude-haiku-4-5"
    default_model: "sonnet"
    supported_params:
      model: "--model"
      thinking: "--thinking"
      max_turns: "--max-turns"
    default_params:
      thinking: "low"
  
  codex:
    enabled: false
    display_name: "GPT Codex"
    command: "codex"
    args_template: ["--prompt", "{prompt}", "--session", "{session_id}"]
    interactive: false
    timeout: 300
    max_concurrent_sessions: 3
    models:
      gpt5.3: "gpt-5.3-codex"
    default_model: "gpt5.3"
    supported_params:
      model: "--model"
      temperature: "--temperature"
      max_tokens: "--max-tokens"
    default_params: {}
  
  gemini:
    enabled: false
    display_name: "Gemini CLI"
    command: "gemini-cli"
    args_template: ["-p", "{prompt}"]
    interactive: false
    timeout: 300
    max_concurrent_sessions: 3
    models:
      gemini3: "gemini-3-pro-preview"
    default_model: "gemini3"
    supported_params:
      model: "-m"
      temperature: "--temp"
    default_params: {}
  
  # duplicate codex/gemini block removed

# ──────────── Watchdog ────────────
watchdog:
  enabled: true
  check_interval: 30
  max_response_time: 120
  max_memory_per_session_mb: 512
  notify_on_restart: true

# ──────────── 会话管理 ────────────
session:
  workspace_base: "./workspaces"
  cleanup_inactive_after_hours: 24
  cleanup_files_after_days: 7
  max_sessions_per_user: 5

# ──────────── 日志 ────────────
logging:
  level: "INFO"
  file: "./logs/gateway.log"
  max_size_mb: 50
  backup_count: 3
  
  audit:
    enabled: true
    file: "./logs/audit.log"
