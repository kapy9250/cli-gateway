# CLI Gateway Configuration Template
# Copy to config.yaml and fill in your values

# ──────────── 鉴权 ────────────
# 全局设置：速率限制、管理员等
auth:
  max_requests_per_minute: 30
  admin_users:
    - 123456789  # Replace with your admin user ID
  state_file: "./data/auth_state.json"

# ──────────── 消息通道 ────────────
# 每个渠道有自己独立的 allowed_users 名单
# Telegram/Discord: 用户 ID (数字)
# Email: 发件人邮箱地址 (字符串)
channels:
  telegram:
    enabled: true
    token: "${TG_BOT_TOKEN}"  # Set via environment variable
    parse_mode: "HTML"
    max_message_length: 4096
    allowed_users:
      - 123456789  # Replace with your Telegram user ID

  discord:
    enabled: false
    token: "${DISCORD_BOT_TOKEN}"  # Set via environment variable
    max_message_length: 2000
    allowed_guilds: []  # Empty = allow all guilds
    members_intent: false  # Set true if you need member info
    allowed_users:
      - 123456789  # Replace with your Discord user ID

  email:
    enabled: false
    imap_host: "imap.gmail.com"
    imap_port: 993
    smtp_host: "smtp.gmail.com"
    smtp_port: 587
    username: "${EMAIL_USERNAME}"
    password: "${EMAIL_PASSWORD}"
    poll_interval: 30  # seconds between inbox checks
    data_dir: "./data/email"  # per-sender storage (emails, attachments, sessions)
    allowed_users:  # Email address whitelist
      - "user@example.com"

# ──────────── Channel Rules ────────────
# Rules files in rules/ directory are auto-loaded per channel.
# They inject context into agent sessions so the AI knows
# which platform it's serving (telegram.md, discord.md, email.md).

# ──────────── CLI Agents ────────────
agents:
  claude:
    enabled: true
    display_name: "Claude Code"
    command: "claude"
    args_template: ["-p", "{prompt}", "--session-id", "{session_id}", "--output-format", "text"]
    interactive: false
    timeout: 300
    max_concurrent_sessions: 3
    env:
      CLAUDE_CODE_DISABLE_NONINTERACTIVE_CONSENT: "1"
    models:
      sonnet: "claude-sonnet-4-5"
      opus: "claude-opus-4-6"
      haiku: "claude-haiku-4-5"
    default_model: "sonnet"
    supported_params:
      model: "--model"
      thinking: "--thinking"
      max_turns: "--max-turns"
    default_params:
      thinking: "low"
  
  codex:
    enabled: false
    display_name: "GPT Codex"
    command: "codex"
    args_template: ["--prompt", "{prompt}", "--session", "{session_id}"]
    interactive: false
    timeout: 300
    max_concurrent_sessions: 3
    models:
      gpt5.3: "gpt-5.3-codex"
    default_model: "gpt5.3"
    supported_params:
      model: "--model"
      temperature: "--temperature"
      max_tokens: "--max-tokens"
    default_params: {}
  
  gemini:
    enabled: false
    display_name: "Gemini CLI"
    command: "gemini-cli"
    args_template: ["-p", "{prompt}"]
    interactive: false
    timeout: 300
    max_concurrent_sessions: 3
    models:
      gemini3: "gemini-3-pro-preview"
    default_model: "gemini3"
    supported_params:
      model: "-m"
      temperature: "--temp"
    default_params: {}
  
  codex:
    enabled: false
    display_name: "Codex"
    command: "codex"
    args_template: ["--quiet", "{prompt}", "--approval-mode", "full-auto"]
    interactive: false
    timeout: 300
    max_concurrent_sessions: 2
    env: {}
  
  gemini:
    enabled: false
    display_name: "Gemini CLI"
    command: "gemini"
    args_template: ["-p", "{prompt}"]
    interactive: false
    timeout: 300
    max_concurrent_sessions: 2
    env: {}

# ──────────── 账单 ────────────
# Billing files are stored outside the session workspace
# to prevent users from accessing cost data.
billing:
  dir: "./data/billing"

# ──────────── Watchdog ────────────
watchdog:
  enabled: true
  check_interval: 30
  max_response_time: 120
  max_memory_per_session_mb: 512
  notify_on_restart: true

# ──────────── 会话管理 ────────────
session:
  workspace_base: "./workspaces"
  cleanup_inactive_after_hours: 24
  cleanup_files_after_days: 7
  max_sessions_per_user: 5

# ──────────── 日志 ────────────
logging:
  level: "INFO"
  file: "./logs/gateway.log"
  max_size_mb: 50
  backup_count: 3
  
  audit:
    enabled: true
    file: "./logs/audit.log"
