# 2026-02-02

## Polymarket NHL bot + edge project lessons

### 1) CLOB orderbook can return "ghost book" (0.01/0.99)
- Symptom: `bestBid=0.01` and `bestAsk=0.99` across many markets; bot/logs labeled as `restricted` and skipped entries.
- Evidence: Frontend showed normal order book (e.g., 44–51¢) while API `/book` returned 0.01/0.99.
- Actionable fix:
  - Do NOT treat 0.01/0.99 as real prices; label as `SENTINEL_BOOK`/`GHOST_BOOK`.
  - Use CLOB `/price` (buy/sell) and `/midpoint` as primary price for decisions; orderbook only as secondary depth check.

### 2) clob-client getPrice side parameter must be lowercase
- In `@polymarket/clob-client`, `getPrice(tokenId, side)` expects `side` to be `'buy'` / `'sell'` (lowercase).
- Using `'BUY'/'SELL'` can break fallback pricing and perpetuate ghost-book behavior.

### 3) Risk guard vs intended behavior
- If `totalMaxUSDC`/guardThreshold is enabled, bot may stop adding new games even when `perGameUSDC` would suggest more orders.
- If desired behavior is "keep ordering as long as balance >= perGameUSDC", set `totalMaxUSDC<=0` (treated as disabled) and gate only on balance.

### 4) Shell execution pitfalls in this environment
- Many exec contexts run `/bin/sh` (dash), not bash.
- `set -euo pipefail` fails under sh (`Illegal option -o pipefail`). Use `bash -lc '...'` or bash shebang.

### 5) Python often not installed
- `python`/`python3` may be missing; diagnostic scripts should default to Node (`node -e` or small JS scripts) for log parsing.

### 6) Reporting/observability
- Add self-proving fields to logs (bid/ask/spread/mid, sentinel flags, price source) to distinguish data issues from market restrictions.
- Prefer decision enums like `SKIP_SENTINEL_PRICE`, `SKIP_WIDE_SPREAD`, `TRULY_RESTRICTED` to avoid confusion.
